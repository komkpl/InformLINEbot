name: Send LINE Message Every 2 Weeks

on:
  schedule:
    - cron: '*/1 * * * *'   # ← テスト用に1分ごと
  workflow_dispatch:

jobs:
  send_message:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Send LINE message (JP + EN with date range)
        run: |
          CURRENT="${{ steps.names_before.outputs.current }}"
          PREVIOUS="${{ steps.names_before.outputs.previous }}"
          RANGE_JP="${{ steps.daterange.outputs.range_jp }}"

          JP1="${RANGE_JP} のゴミ捨て当番は ${CURRENT} さんです！"
          JP2="${PREVIOUS} さんは、すべてのゴミを出しておいてください！"
          EN1="Garbage duty for the period ${RANGE_JP} is assigned to ${CURRENT}."
          EN2="${PREVIOUS}, please make sure all the trash is taken out."

          cat <<EOF > body.json
          {
            "to": "${{ secrets.LINE_GROUP_ID }}",
            "messages": [
              {
                "type": "text",
                "text": "${JP1}\n\n${JP2}\n\n${EN1}\n\n${EN2}"
              }
            ]
          }
          EOF

          curl -v -X POST https://api.line.me/v2/bot/message/push \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer ${{ secrets.LINE_ACCESS_TOKEN }}" \
            -d @body.json